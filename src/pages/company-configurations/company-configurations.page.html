<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>CONFIGURA√á√ïES</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" [formGroup]="cadastroForm">
  <div class="logo-wrapper">
    <div class="logo-container" (click)="selecionarImagem()">
      <img
        *ngIf="imagemPreview"
        [src]="imagemPreview"
        alt="Logo Preview"
        class="logo-preview"
      />
      <ion-icon
        *ngIf="!imagemPreview"
        name="cloud-upload-outline"
        class="upload-icon"
      ></ion-icon>
      <input
        type="file"
        hidden
        accept="image/*"
        #fileInput
        (change)="onImagemSelecionada($event)"
      />
    </div>
    <div class="logo-msg">Clique para enviar a logo</div>
  </div>

  <ion-list lines="none">
    <ion-item>
      <ion-label position="floating">CNPJ</ion-label>
      <ion-input
        type="text"
        formControlName="cnpj"
        maxlength="18"
        (ionInput)="formatarCNPJ($event)"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">NOME DA EMPRESA</ion-label>
      <ion-input formControlName="name"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">ENDERE√áO</ion-label>
      <ion-input
        formControlName="address"
        placeholder="endere√ßo, n√∫mero"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">CIDADE</ion-label>
      <ion-input formControlName="city"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="floating">ESTADO</ion-label>
      <ion-select
        formControlName="state"
        interface="action-sheet"
        placeholder="Selecione seu estado"
      >
        <ion-select-option *ngFor="let state of states" [value]="state.id">
          {{ state.id }} ({{ state.name }})
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="floating">CATEGORIA</ion-label>
      <ion-select
        formControlName="category"
        interface="action-sheet"
        placeholder="Selecione a categoria"
      >
        <ion-select-option
          *ngFor="let category of categories"
          [value]="category.id"
        >
          {{ category.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>
  </ion-list>

  <div class="horario-box">
    <ion-label class="label-titulo">Hor√°rios de Atendimento *</ion-label>
    <div class="horario-scroll">
      <ion-grid>
        <ion-row
          *ngFor="let weekday of weekDays; let i = index"
          [formGroup]="getHorarioFormGroup(i)"
          class="ion-align-items-center"
        >
          <ion-col size="4">
            <ion-label>{{ weekday }}</ion-label>
            <input type="hidden" formControlName="weekday" [value]="weekday" />
          </ion-col>
          <ion-col size="2">
            <ion-toggle formControlName="activated"></ion-toggle>
          </ion-col>
          <ion-col
            size="6"
            *ngIf="getHorarioFormGroup(i).get('activated')?.value"
          >
            <ion-item>
              <ion-label position="floating">In√≠cio</ion-label>
              <ion-input
                type="time"
                formControlName="start"
                required
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="floating">Fim</ion-label>
              <ion-input type="time" formControlName="end" required></ion-input>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
  </div>

  <ion-list lines="none">
    <ion-item>
      <ion-label>Abrir fila automaticamente</ion-label>
      <ion-toggle formControlName="openAutomatic"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-label>Aceitar pessoas em outras filas</ion-label>
      <ion-toggle formControlName="acceptOtherQueues"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-label>Atender fora de ordem</ion-label>
      <ion-toggle formControlName="answerScheduledTime"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-label>Atender com hora marcada</ion-label>
      <ion-toggle formControlName="answerScheduledTime"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-label>Enviar aviso por WhatsApp</ion-label>
      <ion-toggle formControlName="whatsAppNotice"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-label>Remover cliente chamado da fila ap√≥s:</ion-label>
      <ion-input
        type="number"
        formControlName="timeRemoval"
        placeholder="Minutos"
        style="max-width: 80px; margin-left: 8px"
      >
      </ion-input>
    </ion-item>
  </ion-list>

  <div class="wallpaper-wrapper">
    <div class="wallpaper-container" (click)="selecionarWallpaper()">
      <img
        *ngIf="wallpaperPreview"
        [src]="wallpaperPreview"
        alt="Wallpaper Preview"
        class="wallpaper-preview"
      />
      <ion-icon
        *ngIf="!wallpaperPreview"
        name="image-outline"
        class="upload-icon"
      ></ion-icon>
      <div class="overlay">Clique para alterar</div>
      <input
        type="file"
        hidden
        accept="image/*"
        #wallpaperInput
        (change)="onWallpaperSelecionado($event)"
      />
    </div>
    <div class="wallpaper-msg">
      Clique para enviar o papel de parede da loja
    </div>

    <button
      *ngIf="wallpaperPreview"
      class="remove-wallpaper-btn"
      (click)="removerWallpaper()"
    >
      Remover Papel de Parede
    </button>
  </div>

  <ion-list lines="none">
    <ion-item>
      <ion-label position="floating">SUBTITULO LOJA</ion-label>
      <ion-input formControlName="storeSubtitle"></ion-input>
    </ion-item>
  </ion-list>

  <!-- √çcones e Frases pra colocar embaixo da logo no perfil da empresa -->
  <div class="icone-frase-wrapper ion-margin-top">
    <ion-label class="label-titulo">DESTAQUES DA LOJA:</ion-label>

    <div formArrayName="highLights">
      <div
        *ngFor="let highlight of highLights.controls; let i = index"
        [formGroupName]="i"
        class="icone-frase-item"
      >
        <ion-item>
          <ion-select formControlName="icon" placeholder="Escolher √≠cone">
            <ion-select-option value="flame">üî• Fogo</ion-select-option>
            <ion-select-option value="cut">‚úÇÔ∏è Tesoura</ion-select-option>
            <ion-select-option value="chair">ü™ë Cadeira</ion-select-option>
          </ion-select>

          <ion-input
            formControlName="phrase"
            placeholder="Frase relacionada"
            class="ion-margin-start"
          ></ion-input>

          <ion-button
            color="danger"
            fill="clear"
            (click)="removerIconeFrase(i)"
          >
            <ion-icon name="trash"></ion-icon>
          </ion-button>
        </ion-item>
      </div>
    </div>

    <ion-button expand="block" fill="outline" (click)="adicionarIconeFrase()">
      Adicionar √çcone + Frase
    </ion-button>
  </div>

  <ion-button
    expand="block"
    color="primary"
    class="btn-cadastro"
    [disabled]="sending"
    (click)="enviar()"
  >
    <ion-spinner *ngIf="sending" name="crescent" slot="start"></ion-spinner>
    <ion-icon
      *ngIf="!sending && saved"
      name="checkmark-circle"
      slot="start"
    ></ion-icon>
    {{ sending ? 'Salvando...' : saved ? 'Salvo!' : 'SALVAR' }}
  </ion-button>
</ion-content>
