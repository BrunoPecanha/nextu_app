<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        defaultHref="/select-company"
        text=""
        icon="arrow-back-outline"
      ></ion-back-button>
    </ion-buttons>
    <ion-title>SELECIONE A FILA</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="abrirLojaDetalhada()">
        <ion-icon slot="icon-only" name="storefront-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<div class="header-loja-dinamico">
  <div class="banner-loja" *ngIf="store?.storeLogoPath">
    <img
      [src]="store?.storeLogoPath"
      alt="Banner da loja"
      class="banner-image"
    />
  </div>
  <div class="info-loja">
    <img
      [src]="store?.storeLogoPath || 'assets/images/utils/default-logo.png'"
      (load)="logoLoaded = true"
      [class.loaded]="logoLoaded"
      class="logo-loja shimmer"
    />
    <div *ngIf="!logoLoaded" class="shimmer-placeholder logo-placeholder"></div>
    <h2 class="nome-loja">{{ store?.name || "King's Sons - Barbershop" }}</h2>
    <p class="descricao-loja">
      {{ store?.subtitle || 'Cortes na régua, química e aquele trato na régua.'
      }}
    </p>
  </div>
</div>

<ion-content class="scroll-area">
  <div
    class="filas-wrapper"
    *ngIf="store?.professionals?.length; else semFilas"
  >
    <ion-card
      class="fila-card"
      *ngFor="let fila of store?.professionals"
      (click)="entrarNaFila(fila)"
    >
      <ion-card-header>
        <ion-item lines="none">
          <ion-label>
            <h2>{{ fila.name }}</h2>
            <p>{{ fila.subtitle || 'Serviço disponível' }}</p>
          </ion-label>
          <ion-buttons slot="end">
            <ion-button fill="clear" (click)="toggleLike(fila, $event)">
              <ion-icon
                [name]="fila.liked ? 'heart' : 'heart-outline'"
                color="danger"
              ></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-card-header>
      <ion-card-content>
        <div class="fila-info">
          <ion-icon name="time-outline"></ion-icon>
          <div class="tempo-estimado-texto">
            <span
              >Estimado de espera: {{ fila.averageWaitingTime | slice:0:5 ||
              '--' }} min</span
            >
            <small class="tempo-estimado-observacao"
              >O tempo é estimado, pode ser que demore menos ou mais</small
            >
            <div
              class="barra-progresso-wrapper"
              [attr.title]="getStatusFilaTexto(fila.customersWaiting)"
            >
              <div
                class="barra-progresso"
                [style.width.%]="getProgressoFila(fila.customersWaiting)"
                [ngStyle]="{ 'background-color': getCorProgresso(fila.customersWaiting) }"
              ></div>
            </div>
          </div>
        </div>

        <div class="fila-info">
          <ion-icon name="people-outline"></ion-icon>
          <span>Pessoas na fila: {{ fila.customersWaiting || 0 }}</span>
        </div>

        <div class="fila-info" *ngIf="fila.servicesProvided">
          <ion-icon name="construct-outline"></ion-icon>
          <span>Serviços: {{ fila.servicesProvided }}</span>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <ng-template #semFilas>
    <div class="mensagem-vazia">
      <p>Nenhuma fila disponível no momento.</p>
    </div>
  </ng-template>
</ion-content>

<app-footer-menu></app-footer-menu>
