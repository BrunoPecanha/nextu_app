<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/role-registration" text="" icon="arrow-back-outline"></ion-back-button>
    </ion-buttons>

    <ng-container *ngIf="!searching; else searchBar">
      <ion-title class="header-title">ESTABELECIMENTOS</ion-title>
      <ion-buttons slot="end">
        <ion-button fill="clear" (click)="toggleSearch()" class="search-button">
          <ion-icon slot="icon-only" name="search-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ng-container>

    <ng-template #searchBar>
      <ion-searchbar
        [(ngModel)]="searchQuery"
        (ionInput)="onSearch($event)"
        placeholder="Buscar estabelecimentos..."
        (ionCancel)="toggleSearch()"
        class="custom-searchbar"
        animated
        clear-input="true">
      </ion-searchbar>
    </ng-template>
  </ion-toolbar>
  
  <div class="categories-container" *ngIf="categories?.length">
    <div class="categories-scroll">
      <div
        *ngFor="let category of categories"
        (click)="selectCategory(category.id)"
        [class.selected]="selectedCategoryId === category.id"
        class="category-pill">
        <div class="category-icon">
          <img [src]="category.imgPath" alt="{{ category.name }}" />
        </div>
        <span class="category-name">{{ category.name }}</span>
      </div>
    </div>
  </div>
</ion-header>

<ion-content class="modern-content">  
  <div *ngIf="!companies?.length" class="loading-container">
    <ion-spinner name="crescent" class="loading-spinner"></ion-spinner>
    <p class="loading-text">Carregando estabelecimentos...</p>
  </div>
    
  <div class="companies-grid">
    <ion-card
      *ngFor="let card of filteredCards"
      class="company-card"
      (click)="selectCard(card)">
      
      <div class="card-header">
        <div class="logo-wrapper">
          <ng-container *ngIf="card.logoPath; else defaultLogo">
            <img [src]="card.logoPath" alt="{{ card.name }}" class="company-logo" />
          </ng-container>
          <ng-template #defaultLogo>
            <div class="default-logo">
              <ion-icon name="business"></ion-icon>
            </div>
          </ng-template>
        </div>
                
        <div class="new-badge" *ngIf="card.isNew">NOVO</div>
        
        <ion-button fill="clear" class="like-button" (click)="toggleLike(card, $event)">
          <ion-icon 
            [name]="card.liked ? 'heart' : 'heart-outline'" 
            [color]="card.liked ? 'danger' : 'medium'">
          </ion-icon>
        </ion-button>
      </div>

      <ion-card-content class="card-content">
        <h2 class="company-name">{{ card.name }}</h2>
        <p class="company-category">{{ card.category }}</p>
        
        <div class="company-stats">
          <div class="stat-item">
            <ion-icon name="people-outline" class="stat-icon"></ion-icon>
            <span>Fila menor: 4 pessoas</span>
          </div>
          
          <div class="rating-badge">
            <ion-icon name="star" class="star-icon"></ion-icon>
            <span>{{ card.rating || '0' }}</span>
            <small>({{ card.votes || '0' }} avaliações)</small>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>

<app-footer-menu></app-footer-menu>